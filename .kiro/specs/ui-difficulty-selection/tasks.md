# Implementation Plan

## Task Format
- Major+Sub タスク形式。`(P)` で並行可能を示す。
- テストが後追いなら `- [ ]*` を使用。

## Tasks
- [x] 1. タイトル/開始画面（難易度選択UI）の追加
- [x] 1.1 タイトル（または新規開始）シーンを追加し、ゲーム開始前にUIを表示する
  - 既存の「起動直後にプレイ開始」フローを、`Title -> Playing` の状態遷移に変更
  - デフォルトは NORMAL を選択状態として表示
  - _Requirements: 1.1,1.5_
- [x] 1.2 難易度オプション（EASY/NORMAL/HARD）と簡易説明文を表示する
  - 例: EASY=「球が遅くパドルが大きい」, NORMAL=「標準」, HARD=「球が速くブロックが多い」
  - _Requirements: 1.1,1.4_
- [x] 1.3 キーボードで難易度選択（フォーカス移動）と決定（Enter等）をできるようにする
  - 選択移動は Up/Down または Left/Right のどちらかに統一（設計で明記）
  - _Requirements: 1.3_
- [x] 1.4 マウスで難易度選択（クリック）と決定をできるようにする
  - クリック判定用に表示領域（ボタン/行）に当たり判定を持たせる
  - _Requirements: 1.3_

- [x] 2. 選択結果の適用（開始時にレイアウトへ反映）
- [x] 2.1 開始ボタン押下時に、選択難易度から `LayoutConfig` を生成してプレイを開始する
  - 既存 `config.LayoutWithDifficulty`（または同等の生成関数）を利用し、選択値を適用した `layout` を作る
  - 「最初のブロック生成より前」に適用されること（GenerateBlocks/NewGameStateの前）
  - _Requirements: 1.2,2.1_
- [x] 2.2 生成・適用のエラー（未知難易度等）はデフォルトへフォールバックし、選択状態/表示へ反映する
  - UI側の選択肢制限に加え、ドメイン/設定層でも安全にフォールバック
  - _Requirements: 1.5,2.1_

- [x] 3. ポーズ（情報表示）と確認性の追加
- [x] 3.1 ポーズ状態を追加し、ポーズ中はゲーム進行（Update）を停止する
  - 例: Esc で Pause/Resume をトグル
  - _Requirements: 2.2_
- [x] 3.2 ポーズ（または情報）表示に、現在の難易度と説明文を表示する
  - 既存の `Difficulty: ...` 表示がある場合は、情報量（説明文）を追加して要件を満たす
  - _Requirements: 2.2_

- [x] 4. 実装の境界整理（状態/入力/描画）
- [x] 4.1 シーン状態（Title/Playing/Paused/GameOver 等）の責務を明確化し、状態遷移を一箇所に集約する
  - `EbitenGame`（adapter）でシーン管理し、`GameUsecase` は Playing のみを担当する、など
  - _Requirements: 1.2,2.1,2.2_
- [x] 4.2 UI入力（選択/決定/ポーズ）とゲーム入力（左右移動）を衝突しない形で扱う
  - 例: シーンごとに入力ハンドリングを分ける／InputStateを拡張する／UIはebiten直接参照など、方針を設計に合わせて統一
  - _Requirements: 1.3,2.2_

- [x] 5. テスト
- [x] 5.1 タイトル画面のデフォルト選択と、難易度変更→開始の動作をテストする
  - NORMALがデフォルトで選択されること、選択に応じたlayoutが生成されること
  - _Requirements: 1.1,1.2,1.5,2.1_
- [x] 5.2 入力（キーボード/マウス）の難易度選択操作をテストする (P)
  - フォーカス移動、クリック判定、決定イベントが期待通り発火すること
  - _Requirements: 1.3_
- [x] 5.3 ポーズ中の停止と難易度表示をテストする (P)
  - PauseでUpdateが止まること、表示に難易度と説明が含まれること
  - _Requirements: 2.2_

