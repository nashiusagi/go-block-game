# Implementation Plan

- [ ] 1. レイアウト設定と乱数源の用意
- [ ] 1.1 LayoutConfigを拡張し、画面サイズ・ブロックサイズ・総数・最小Yギャップ・パドルY・試行上限・シードを保持するよう定義する
  - `minPaddleGap` を定数化し、パドルYからの距離制約に使う（例: 180px 程度を設定し、画面高さとパドル位置を考慮）
  - `maxAttempts` を `blockCount * 10` など十分な上限に設定し、0や負数を拒否する
  - _Requirements: 1.4,2.1,2.2,2.3,3.1_
- [ ] 1.2 (P) RandomSource を実装し、`math/rand` をラップして任意シード設定と非決定的シード（時刻初期化）を切り替えられるようにする
  - `Seed` が指定された場合は再現性を担保し、未指定なら現在時刻を使う
  - _Requirements: 4.1,4.2,4.3_

- [ ] 2. ブロック生成ロジックの実装
- [ ] 2.1 GenerateBlocks 関数を追加し、境界内配置・重なり排除・最小Yギャップを満たすブロック座標を生成する
  - AABBで重なりを判定し、違反時は再試行する
  - 画面左右・上下の境界内に収める（ブロック幅・高さを考慮）
  - パドルYから `minPaddleGap` 以上離れたYにのみ配置する
  - _Requirements: 1.1,1.2,1.3,1.4,1.5,2.1,2.2,3.1,3.2_
- [ ] 2.2 試行上限とエラー処理を実装し、上限超過時にエラーを返す
  - リトライ回数をカウントし、`maxAttempts` 超過で即エラー
  - _Requirements: 1.3,1.4,2.3,3.2_

- [ ] 3. ゲーム初期化への統合
- [ ] 3.1 initBlocks を更新し、LayoutConfig と RandomSource を用いて GenerateBlocks を呼び出して結果を `g.blocks` に設定する
  - 失敗時のフォールバック方針を実装（例: 固定グリッドへの切替や再シード再試行のどちらかを選択して明示）
  - 生成したブロック総数が期待値に一致することを確認する
  - _Requirements: 1.1,1.4,2.1,2.3,3.1,3.2,4.1,4.3_
- [ ] 3.2 設定値の整合性を確認し、`minPaddleGap` と `maxAttempts` をゲーム定数として反映する
  - パドルYと画面サイズの変化に対応できるよう、定数定義の位置と算出を整理する
  - _Requirements: 1.4,2.1,2.2,2.3,3.1_

- [ ] 4. テスト
- [ ] 4.1 GenerateBlocks のユニットテストを追加し、固定シードで決定的な配置が再現されることを検証する
  - ブロック総数、境界内、重なりなし、`minPaddleGap` 準拠を確認
  - _Requirements: 1.1,1.2,1.3,1.4,1.5,2.1,2.2,3.1,3.2,4.2_
- [ ] 4.2 試行上限超過時にエラーとなることを検証し、フォールバック動作をカバーするテストを追加する
  - 意図的に狭い領域・低上限を設定してエラー経路を確認
  - _Requirements: 1.3,1.4,2.3,3.2_
- [ ] 4.3 initBlocks 経由の統合テストで、総数・境界・最小Yギャップが保持されることを確認する
  - パドルY変更時もギャップを満たすことを確認
  - _Requirements: 1.1,1.4,2.1,2.2,2.3,3.1,3.2,4.3_

